{% extends "admin/base_site.html" %}
{% load static %}
{% load i18n %}

{% block title %}Adicionar Orçamento | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/orcamento_new.css' %}">
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">Home</a>
  › <a href="{% url 'admin:marcenaria_orcamento_changelist' %}">Orçamentos</a>
  › Adicionar
</div>
{% endblock %}

{% block content %}
<div id="content-main">
  <h1>Adicionar Orçamento</h1>

  <form method="post">
    {% csrf_token %}

    <div class="section">
      <h2>Informações Básicas</h2>
      
      <div class="form-row">
        <label class="label" for="cliente">Cliente *</label>
        <input type="text" 
               id="cliente" 
               name="cliente" 
               class="input-field" 
               value="{{ cliente|default:'' }}" 
               placeholder="Nome do cliente"
               required>
        {% if errors.cliente %}
          <div class="errorlist">{{ errors.cliente }}</div>
        {% endif %}
      </div>
      
      <div class="form-row">
        <label class="label" for="status">Status</label>
        <select id="status" name="status" class="input-field">
          {% for value, label in status_choices %}
            <option value="{{ value }}" {% if status == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
        {% if errors.status %}
          <div class="errorlist">{{ errors.status }}</div>
        {% endif %}
      </div>
    </div>

    <div class="section">
      <h2>Ambientes e Móveis</h2>
      
      <div class="amb-add">
        <input type="text" 
               id="ambienteNome" 
               class="input-field" 
               placeholder="Nome do ambiente" 
               style="max-width: 300px;">
        <button type="button" class="btn btn-primary" id="btnAddAmbiente">
          Adicionar ambiente
        </button>
      </div>
      
      <div class="help">
        Adicione quantos ambientes quiser. Para cada ambiente, você poderá adicionar móveis e peças.
      </div>
      
      <div id="ambientesContainer" class="ambientes-container">
        <div class="empty-state">Nenhum ambiente adicionado</div>
      </div>
      
      {% if errors.ambientes %}
        <div class="errorlist">{{ errors.ambientes }}</div>
      {% endif %}
    </div>

    <!-- Campos hidden para dados JSON -->
    <input type="hidden" name="ambientes_json" id="ambientesJson" value="{{ ambientes_json|default:'[]' }}">

    <div class="submit-row toolbar">
      <button type="submit" class="btn btn-primary">
        Salvar Orçamento
      </button>
      <a class="btn btn-secondary" href="{{ changelist_url }}">
        Cancelar
      </a>
    </div>
  </form>

  <!-- Modal para adicionar móvel -->
  <div id="modalMovel" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Adicionar Móvel</h3>
      <div class="form-row">
        <label class="label" for="movelNome">Nome do Móvel</label>
        <input type="text" id="movelNome" class="input-field" placeholder="Ex: Mesa de jantar, Armário">
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-primary" id="btnSalvarMovel">Salvar</button>
        <button type="button" class="btn btn-secondary" id="btnCancelarMovel">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para adicionar peça -->
  <div id="modalPeca" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Adicionar Peça</h3>
      
      <div class="form-row">
        <label class="label" for="tipoPeca">Tipo de Peça</label>
        <select id="tipoPeca" class="input-field">
          <option value="">Selecione...</option>
          {% for tipo in tipos_pecas %}
            <option value="{{ tipo.codigo }}">{{ tipo.nome }}</option>
          {% endfor %}
        </select>
      </div>

      <div id="componentesContainer" style="display: none;">
        <div class="form-row">
          <label class="label" for="componentePeca">Componente</label>
          <select id="componentePeca" class="input-field">
            <option value="">Selecione...</option>
          </select>
        </div>
      </div>

      <div id="camposCalculoContainer">
        <!-- Campos serão inseridos dinamicamente aqui -->
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-primary" id="btnSalvarPeca">Salvar Peça</button>
        <button type="button" class="btn btn-secondary" id="btnCancelarPeca">Cancelar</button>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script src="{% static 'js/orcamento_new.js' %}" defer></script>
{% endblock %}